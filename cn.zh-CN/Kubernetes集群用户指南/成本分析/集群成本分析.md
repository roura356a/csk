---
keyword: [成本分析, 集群]
---

# 集群成本分析

ACK的成本分析功能可以协助企业IT管理员了解集群资源使用量及成本分布，提升集群资源利用率，提供成本节约建议。本文介绍如何配置集群成本分析及集群成本分析功能介绍。

-   您已创建1.18.8及以上版本的Kubernetes集群。具体操作，请参见[创建Kubernetes托管版集群](/cn.zh-CN/Kubernetes集群用户指南/集群/创建集群/创建Kubernetes托管版集群.md)。
-   Kubernetes集群已开启阿里云Prometheus监控。具体操作，请参见[开启阿里云Prometheus监控](/cn.zh-CN/Kubernetes集群用户指南/可观测性/监控管理/阿里云Prometheus监控.md)。
-   使用成本分析功能前，请[提交工单](https://selfservice.console.aliyun.com/ticket/createIndex)申请添加白名单。

## 功能介绍

容器服务成本分析主要包含以下几个重要的功能：

-   云资源费用分析

    将Kubernetes集群下所有的云资源费用进行聚合，支持查看集群整体费用的同比与环比。

-   集群费用趋势分析

    查看Kubernetes集群下所有云资源的消费趋势，分析热点云产品消费，协助成本节约决策。

-   集群成本节约推荐

    将Kubernetes集群的费用趋势进行分析，提供资源用量和成本消费的相关性分析，提供成本节约建议。

-   实时价格模拟预测

    将集群中计算资源的实时价格进行模拟，提供小时维度的成本预估，支持包年包月、按量付费、竞价付费等多种付费方式。

-   命名空间资源分账

    根据命名空间拆分集群成本比例，提供实时成本预估、成本趋势变化、集群成本占比等能力。

-   应用成本优化

    在命名空间下查看Top 10的成本消耗最多的应用以及应用成本消费的趋势，提供应用维度的成本优化分析能力。


## 配置成本分析

1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。

2.  在控制台左侧导航栏中，单击**集群**。

3.  在集群列表页面中，单击目标集群名称或者目标集群右侧**操作**列下的**详情**。

4.  在集群管理页左侧导航栏中，选择**运维管理** \> **成本分析**。

5.  在成本分析页面单击集群的**KubernetesWorkerRole-\*\*\***，在RAM控制台完成RAM授权策略。

    ![RAM授权策略](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9138960261/p272320.png)

    1.  在RAM角色管理页面单击**K8sWorkerRolePolicy-\*\*\***权限策略名称。

    2.  进入权限策略管理页面，单击**修改策略内容**。

    3.  在修改策略内容面板增加以下内容后，单击**确定**。

        ```
                {
                    "Action": [
                        "bssapi:QueryInstanceBill"
                    ],
                    "Resource": "*",
                    "Effect": "Allow"
                },
                {
                    "Action": [
                        "ecs:DescribeSpotPriceHistory",
                        "ecs:DescribeInstances",
                        "ecs:DescribePrice"
                    ],
                    "Resource": "*",
                    "Effect": "Allow"
                }
        ```

        **说明：** 多个策略内容需要用半角逗号（,）分隔。

6.  在成本分析页面单击**开始安装**。

    ![安装组件](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9138960261/p272328.png)

7.  在成本分析页面查看成本可视化大盘。

    **说明：** 在开启成本分析功能后第二天08: 00自动显示账单数据。

    ![成本可视化大盘](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5156460261/p272334.png)


## 使用成本分析能力

![成本可视化大盘详情](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8387460261/p272351.png)

成本可视化大盘的相关功能介绍如下表：

|序号|功能|描述|
|--|--|--|
|①|通过成本趋势判断集群浪费情况|成本的费用，Daily Cost为昨日费用，Day-on-day Ratio为相对昨日费用的变化比率。当相对昨日费用的变化比率的字体颜色为绿色时，表示相比前一日的成本是降低的；当相对昨日费用的变化比率的字体颜色为红色时，表示相比前一日的成本是增涨的。 |
|②|黄色表示成本消费，蓝色表示实际的集群容量。通常情况下，两条曲线会存在一定的相关性。当对两者进行相关性对比后发现两者呈现不一致的趋势，表示集群的单位核成本异常，需要检查是否使用了更贵的资源。 |
|③|一段时间内的成本变化趋势。|
|④|通过命名空间进行部门成本分账|在一个集群中，可能存在各种不同的规格、付费方式的节点类型，当您通过命名空间进行分账时，不能够单一的通过每个命名空间的资源申请值进行判断，同时需要考虑命名空间下Pod所在节点情况。

成本分析通过alibaba-cloud-price-exporter将每个节点的实时费用进行了转换，在统计命名空间维度的费用时，可转换为：

```
Σ(Pod资源申请/节点容量)*节点单位价格
```

这种方式可以精确的估算出命名空间的成本费用，不过由于用户折扣、代金券抵扣、包年包月等各种延迟计费策略，可能会导致命名空间的成本费用和集群的实际账单费用不一致。但是，可以通过命名空间的占比乘以集群总费用的方式获得命名空间级别的分账。 |
|⑤|通过云产品费用趋势与比例分析云产品成本|在集群中会包含多种不同的云产品，不同的使用方式、计费模型会导致云产品的费用上存在比较多的差异。可以通过成本趋势和组合看到不同的云产品消费，从而进行成本决策。|

## 常见问题



