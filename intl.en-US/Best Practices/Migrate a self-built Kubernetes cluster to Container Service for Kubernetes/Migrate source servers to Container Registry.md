---
keyword: [migrate source servers, Container Registry]
---

# Migrate source servers to Container Registry

Server Migration Center \(SMC\) allows you to migrate servers to Container Registry. You can use SMC to migrate containerized applications to Container Registry at low costs. Containerized applications achieve automatic management and distribution of compute resources and ensure the fast and secure deployment of applications. This improves resource usage and reduces compute costs. This topic describes how to migrate a server to Container Registry.

-   The server is not based on a Windows operating system.
-   Container Registry is activated and a container image repository is created. For more information, see [Create a repository and build images]().
-   A Resource Access Management \(RAM\) role is created for the intermediate instance that is generated by SMC for migration. The following parameters are used to configure the RAM role. For more information, see [Create a RAM role for a trusted Alibaba Cloud service](/intl.en-US/RAM Role Management/Create a RAM role/Create a RAM role for a trusted Alibaba Cloud service.md).
    -   Trusted Entity Type: Select **Alibaba Cloud Service**.
    -   Role Type: Select **Normal Service Role**.
    -   Trusted Service: Select **Elastic Compute Service**.
-   A custom policy is created for the RAM role of the intermediate instance. The policy grants the minimum permissions that are required to migrate a server to Container Registry. The following example shows a sample policy. This policy is attached to the RAM role. For more information, see [Create a custom policy](/intl.en-US/Policy Management/Custom policies/Create a custom policy.md) and [Grant permissions to a RAM role](/intl.en-US/RAM Role Management/Grant permissions to a RAM role.md).

    ```
    {
        "Statement": [
            {
                "Effect": "Allow",
                "Action": [
                    "cr:GetAuthorizationToken",
                    "cr:PushRepository",
                    "cr:PullRepository",
                    "cr:CreateRepository"
                ],
                "Resource": [
                    "*"
                ]
            }
        ],
        "Version": "1"
    }
    ```

-   The information about the source server is imported to the SMC console. For more information, see [Step 1: Import the information of a migration source](/intl.en-US/User Guide/Step 1: Import the information of a migration source.md).

    **Note:**

    -   The SMC client V2.3.0 and later support server migration to Container Registry. You can use these SMC clients to import the information about the source server. Click [here](http://p2v-tools.oss-cn-hangzhou.aliyuncs.com/smc/Alibaba_Cloud_Migration_Tool.zip) to download the latest version of the SMC client.
    -   Ensure that the client-side program is running during migration. If data transfer is interrupted, you can restart the client and the migration task to resume migration.

-   For information about Docker container images, see [Terms]().
-   During migration, SMC creates an intermediate instance. The intermediate instance incurs a small fee. For more information, see [Pay-as-you-go](/intl.en-US/Pricing/Billing methods/Pay-as-you-go.md).
-   SMC releases the intermediate instance after the migration task enters the **Finished** or **Expired** state, or when the task is deleted.

## \(Optional\) Step 1: Exclude dynamic data directories from migration

To ensure stable migration, we recommend that you exclude dynamic data directories, such as data directories of large databases. Then, you can stop the services on the source server and start the migration task. Skip this step if you do not need to exclude dynamic data directories.

To exclude dynamic data directories, perform the following steps. You do not need to stop services that are running on the source server. To enable the throttling environment, perform the following steps:

1.  Log on to the source server.

2.  Configure the SMC client and exclude dynamic data directories.

    For more information, see [Exclude files or directories from migration](/intl.en-US/User Guide/Step 1: Import the information of a migration source.mdstep_pln_qm7_6rn).


## Step 2: Create and start a migration task

You can perform the following steps to exclude dynamic data directories. You do not need to stop your services that are running on the source server. To enable the throttling environment, perform the following steps:

1.  Log on to the [SMC console](https://smc.console.aliyun.com/).

2.  In the left-side navigation pane, click **Migration Sources**.

3.  Find the source server from which you want to migrate data.

4.  Click **Create Migration Task** in the **Actions** column.

5.  On the **Create Migration Task** page, set the container image parameters.

    ![site](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/en-US/3446858951/p128528.png)

    Set the following parameters to configure the container image: For more information about other parameters, see [Step 2: Create and start a migration task](/intl.en-US/User Guide/Step 2: Create and start a migration task.md).

    -   **Target Image Type**: the type of the destination image. Select **Container Image**.
    -   **Namespace**: the namespace of the destination image.
    -   **Repository Name**: the name of the repository where the destination image is stored.
    -   **Version**: the version of the destination image.
    -   **RAM Role**: the RAM role that is attached to the intermediate instance.
    The migration task immediately runs after it is created. Possible results are:

    -   If the migration task enters the Finished state, the task is completed and a container image is generated.
    -   If the migration task enters the **InError** state, the task fails. You can check the logs to troubleshoot the failure. Then, restart the migration task. For information about common errors and solutions, see [SMC FAQ](/intl.en-US/FAQ/SMC FAQ.md).

## Step 3: Verify the container image

After you migrate the source server to Container Registry, a container image is created. Perform the following steps to verify the container image. A container image on which NGINX is deployed is used as an example.

1.  Create a Kubernetes cluster in the Container Service for Kubernetes \(ACK\) console. For more information, see [Create a managed Kubernetes cluster](/intl.en-US/User Guide for Kubernetes Clusters/Cluster/Create Kubernetes clusters/Create a managed Kubernetes cluster.md).

2.  Log on to the [ACK console](https://cs.console.aliyun.com).

3.  In the left-side navigation pane, click **Clusters** to view the created Kubernetes cluster.

4.  In the **Actions** column, click **Applications**.

5.  On the **Deployments** tab, click **Create from Image** to create a stateless application.

    Set the following parameters. For information about other parameters and operations, see [Create a stateless application by using a Deployment](/intl.en-US/User Guide for Kubernetes Clusters/Application management/Workloads/Create a stateless application by using a Deployment.md).

    -   On the **Basic Information** tab, set the following parameters:
        -   **Name**: the name of the application. Set the value to nginx.
        -   **Replicas**: the number of application replicas. Set the value to 1.
        -   **Type**: the type of the application. Set the value to **Deployments**.
    -   In the **Container** step, set the following parameters:
        -   **Image Name**: Click **Select Image** to select the container image that is generated after the migration is complete. If the container image repository and the Kubernetes cluster are deployed in the same region, you can use the Virtual Private Cloud \(VPC\) endpoint of the container image to pull the image.
        -   **Image Version**: Click **Select Image Version** to select the version of the container image that is generated after the migration is complete.
        -   **Set Image Pull Secret**: This parameter is required if the container image is a private image. You can also use a plug-in to pull the image. This method does not require a Secret. For more information, see [Use aliyun-acr-credential-helper to pull images without a password](/intl.en-US/User Guide for Kubernetes Clusters/Application management/Image/Use aliyun-acr-credential-helper to pull images without a password.md).
        -   **Port**: Add port 80.

            ![post](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/en-US/3446858951/p128494.png)

        -   **Start**: Enter the /sbin/init command.

            ![cmd](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/en-US/4446858951/p128496.png)

    -   In the **Advanced** step, create a Service to access the application.

        Use the example values in the following figure when you set the required parameters.

        ![server](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/en-US/4446858951/p128500.png)

6.  After the Service is created, click **Details** to view the application status.

7.  In the left-side navigation pane, click **Services and Ingresses** \> **Services**. On the Services page, view the **External Endpoint** of the Service.

8.  You can use a browser to access the external endpoint.

    ![nginx](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/en-US/4446858951/p128509.png)


